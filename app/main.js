/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/main.js":
/*!*********************!*\
  !*** ./src/main.js ***!
  \*********************/
/***/ (() => {

eval("const KEYS = 'qasdfghj'.split('');\nconst MUSIC_NOTES_CONFIG = [{\n  keyboardKey: 'a',\n  frequency: 261.63 // C note, on C major scale\n}, {\n  keyboardKey: 's',\n  frequency: 293.66 // D note\n}, {\n  keyboardKey: 'd',\n  frequency: 329.63 // E note\n}, {\n  keyboardKey: 'f',\n  frequency: 349.23 // F note\n}, {\n  keyboardKey: 'g',\n  frequency: 392 // G note\n}, {\n  keyboardKey: 'h',\n  frequency: 440 // A note\n}, {\n  keyboardKey: 'j',\n  frequency: 493.88 // B note\n}];\nconst SFX_CONFIG = [{\n  keyboardKey: 'q',\n  name: 'splash'\n}];\n\n/*\nPrimary App Class\n */\nclass App {\n  constructor() {\n    console.log('HTML5 Audio Experiment is booting up');\n\n    // General app properties\n    this.audioContext = undefined;\n    this.audioData = undefined;\n\n    // Bind functions to self\n    this.app_onKeyUp = this.app_onKeyUp.bind(this);\n    this.musicNotes_onClick = this.musicNotes_onClick.bind(this);\n    this.sfxButton_onClick = this.sfxButton_onClick.bind(this);\n    this.startButton_onClick = this.startButton_onClick.bind(this);\n\n    // Setup initial UI\n    const htmlMain = document.querySelector('main');\n    htmlMain.addEventListener('keyup', this.app_onKeyUp);\n    htmlMain.focus();\n    document.querySelector('#start-button').addEventListener('click', this.startButton_onClick);\n\n    // Only initialise after user input\n    this.initialised = false;\n  }\n\n  /*\n  Initialise only after user input.\n  AudioContext can't be created until app receives some sort of user input.\n   */\n  async initAfterUserInput() {\n    if (this.initialised) return;\n\n    // Remove start button\n    // document.querySelector('#start-button').removeEventListener('click', this.startButton_onClick)  // Is this necessary?\n    document.querySelector('#start-button').remove();\n\n    // Initiate audio system\n    this.audioContext = new AudioContext();\n    await this.loadFiles();\n\n    // Cleanup\n    this.setupUI();\n    this.initialised = true;\n  }\n  setupUI() {\n    // Add SFX buttons\n    const htmlSFXButtonsContainer = document.querySelector('#sfx-buttons');\n    SFX_CONFIG.forEach(sfx => {\n      const htmlLi = document.createElement('li');\n      const htmlButton = document.createElement('button');\n      htmlButton.innerText = `[${sfx.keyboardKey.toUpperCase()}] ${sfx.name}`;\n      htmlButton.dataset.keyboardKey = sfx.keyboardKey;\n      htmlButton.addEventListener('click', this.sfxButton_onClick);\n      htmlLi.appendChild(htmlButton);\n      htmlSFXButtonsContainer.appendChild(htmlLi);\n    });\n\n    // Add musical notes\n    const htmlMusicNotesContainer = document.querySelector('#music-notes');\n    MUSIC_NOTES_CONFIG.forEach(musicNote => {\n      const htmlLi = document.createElement('li');\n      const htmlButton = document.createElement('button');\n      htmlButton.innerText = `[${musicNote.keyboardKey.toUpperCase()}]`;\n      htmlButton.dataset.keyboardKey = musicNote.keyboardKey;\n      htmlButton.addEventListener('click', this.musicNotes_onClick);\n      htmlLi.appendChild(htmlButton);\n      htmlMusicNotesContainer.appendChild(htmlLi);\n    });\n  }\n  async loadFiles() {\n    this.audioData = {\n      splash: await this.fetchAudioData('assets/bbc-splash.wav')\n    };\n  }\n  async fetchAudioData(filepath) {\n    const res = await fetch(filepath);\n    const arrayBuffer = await res.arrayBuffer();\n    const audioData = await this.audioContext.decodeAudioData(arrayBuffer);\n    return audioData;\n  }\n  app_onKeyUp(e) {\n    if (!this.initialised) {\n      if (e.key === 'Enter' || e.key === ' ') this.initAfterUserInput();\n      return;\n    }\n    const key = e.key.toLowerCase();\n    if (KEYS.includes(key)) this.playKey(key);\n  }\n  musicNotes_onClick(e) {\n    this.playKey(e.target.dataset.keyboardKey);\n  }\n  sfxButton_onClick(e) {\n    this.playKey(e.target.dataset.keyboardKey);\n  }\n  startButton_onClick(e) {\n    this.initAfterUserInput();\n  }\n  playKey(keyboardKey) {\n    console.log('Play Key: ', keyboardKey);\n    MUSIC_NOTES_CONFIG.forEach(musicNote => {\n      if (musicNote.keyboardKey === keyboardKey) {\n        this.playSoundFromCode(musicNote.frequency);\n      }\n    });\n    SFX_CONFIG.forEach(sfx => {\n      if (sfx.keyboardKey === keyboardKey) {\n        this.playSoundFromAudioData(sfx.name);\n      }\n    });\n  }\n\n  /*\n  Play an instance of a sound from registered audio data.\n  For every instance of a sound, create a new AudioBufferSourceNode.\n  Each AudioBufferSourceNode can only have .start() called once.\n   */\n  playSoundFromAudioData(name) {\n    if (!name || !this.audioData?.[name]) {\n      console.error('Can\\'t find audio data for ', name);\n      return;\n    }\n    const audioContext = this.audioContext;\n    const audioSource = audioContext.createBufferSource();\n    audioSource.buffer = this.audioData[name];\n    audioSource.connect(audioContext.destination);\n    audioSource.start();\n  }\n\n  /*\n  Play an instance of a basic sound like a beep or a boop.\n  For every \n   */\n  playSoundFromCode(frequencyHz = 440, type = 'sine', duration = 0.1) {\n    const audioContext = this.audioContext;\n    const oscillator = audioContext.createOscillator();\n    oscillator.type = type;\n    oscillator.frequency.setValueAtTime(frequencyHz, audioContext.currentTime);\n    oscillator.connect(audioContext.destination);\n    oscillator.start(); // Optional: oscillator.start(audioContext.currentTime)\n    oscillator.stop(audioContext.currentTime + duration);\n  }\n}\n\n/*\nInitialise!\n */\nwindow.onload = function () {\n  window.app = new App();\n};\n\n//# sourceURL=webpack://html5-audio-experiment/./src/main.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/main.js"]();
/******/ 	
/******/ })()
;